# Traffic-video-analysis-system
>This rep is a traffic video analysis system which is a final project of a class in School of Computer Science, Sichuan University
## 1. Video analysis

### 1.1 Vehicle identification and tracking

![pic2.png](https://s2.loli.net/2021/12/11/VCfcSHJ71pUYv5K.png)

如上图，对视频中的车辆进行识别并为识别出的每一辆车创建一个跟踪对象，此后每一帧都会对所有的跟踪对象进行位置更新，并且为新捕获到的车辆创建跟踪对象，以及停止对行驶出视频边界的车辆的跟踪。为了更直观展示跟踪效果，在处理得到的视频上，以car ID的形式来唯一标识车辆，并展示出来。

> 这么多中文就不翻译了orz

### 1.2 Speed detection 

![pic1.png](https://s2.loli.net/2021/12/11/9BpCeNIrQka8gzf.png)

如上图，在视频处理过程中，对于识别到的每一辆车都会计算出其的实际速度，并标识在视频上。设置该路口的超速阈值为60Km/h，对于速到超过该阈值的车辆，都会进行违章记录的登记。

对于速度计算，是计算相邻两次检测过程中，车辆在图片上位移的像素点数，乘以一个比例尺换算到现实世界的位移，并以相邻两次检测间隔的帧数比上视频的fps得到时间，从而估算出该瞬时车辆的速度。

### 1.3 Parking detection 

![image.png](https://s2.loli.net/2021/12/18/gTQfVGdODKn4CtL.png)

  如上图，在视频处理过程中，如果识别到违章停车的车辆，会以蓝色方框标记出该车辆，并将该车辆的id，车牌，违章种类等违章信息存入数据库中，并进行截图保存，作为违章的凭证。

违章停车的检测需要首先计算出车辆的速度，并且如果在连续的五次的检测中，该车辆的速度均为0Km/h则将该车辆标识为违章停车。

### 1.4 Yellow-line detection

![image.png](https://s2.loli.net/2021/12/18/un9xgoktYF64WjK.png)

如上图，在视频处理过程中，如果识别到压双黄线的车辆，会以红色方框标记出该车辆，并将该车辆的id，车牌，违章种类等违章信息存入数据库中，并进行截图保存，作为违章的凭证。

![image.png](https://s2.loli.net/2021/12/18/rjLtewElFTbRqz5.png)

上图即为该违章记录图像存储的结果。

压双黄线检测是根据所识别出的车辆的轮廓与双黄线所在的位置进行判断。首先通过判断车辆轮廓最左下和右下角的点来确定车辆的左右两轮是位于双黄线的同侧，若否，则被认定为压双黄线。


### 1.5 Red light detection

![image.png](https://s2.loli.net/2021/12/18/SF4jG2sAaxHIkZn.png)

![image.png](https://s2.loli.net/2021/12/18/PefWM8tYNz7mZ9X.png)

如图，对于上面的场景，场景中为绿灯，并且在处理中也同样可以得到正确的识别结果，即为绿灯。

红绿灯识别的算法是，首先将截取的信号灯图像转换到HSV空间，并设置一个区分红色、绿色与黄色的阈值，随后逐个像素统计其中被识别为红色、绿色、黄色的像素点的个数，并根据其数量关系判断出当前红绿灯的颜色。

闯红灯检测的前提条件是在当前直行的红绿灯颜色为红色的情况下，若是车身的一半已经超出了停止线，则将该车辆被认定为闯红灯。

### 1.6 Retrograde detection

逆行检测需要首先判断车辆所在的车道，再判断车辆的运行方向是否与预期的一致从而得出结论。判断车辆所在的车道，即判断识别出的车辆的轮廓的左下或右下点与双黄线的位置关系，如若车辆在右车道，则其轮廓右下角的点，即其右后轮一定在双黄线的右侧；若车辆在左车道，则其轮廓左下角的点，即其左前轮一定在双黄线的左侧，若是两车轮分立在双黄线两侧则交给压双黄线检测模块处理。但是单单这样会对转弯的车辆进行误判。

![image.png](https://s2.loli.net/2021/12/18/Cx5QXEWSkNRlhTe.png)

如图，成功解决了转弯车辆的逆行误判问题，通过计算衡量车辆在图像上x方向上的位移与y方向上位移，从而判断出转弯车辆，并在逆行检测时，排除这一类车辆。

